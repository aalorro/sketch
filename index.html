<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sketchify ‚Äî Image to Sketch</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <button class="dark-mode-toggle" id="darkModeToggle" type="button" title="Toggle dark mode">üåô</button>
  
  <header>
    <img src="img/sketchify_banner.jpg" alt="Sketchify Banner" style="width:100%;max-height:200px;object-fit:cover;display:block;margin-bottom:16px;border-radius:8px">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
      <div style="font-size:28px">‚úèÔ∏è</div>
      <div>
        <h1>SKETCHIFY</h1>
        <div class="logo-text">by ARTMONDO</div>
      </div>
    </div>
    <p>Turn your photos into masterpiece sketches with 20+ artistic styles ‚Äî adjust intensity, brush type, and color while watching live previews. No uploads, no servers ‚Äî all processing happens locally.</p>
  </header>

  <main>
    <section class="controls">
      <div class="buttons" style="margin-bottom:12px">
        <button id="undo" type="button" title="Undo (Ctrl+Z)">‚Ü∂</button>
        <button id="redo" type="button" title="Redo (Ctrl+Y)">‚Ü∑</button>
        <button id="resetAll" type="button" title="Reset all controls">Reset</button>
      </div>
      <label>Load image <button type="button" class="info-btn" data-modal="modal-load">?</button><input id="file" type="file" accept="image/*" multiple></label>
      <div id="fileInfo" style="display:none;margin-bottom:8px;padding:8px;border-radius:6px;font-size:12px;color:#333">
        <div id="fileCount"></div>
        <div id="fileWarning" style="display:none;margin-top:6px;padding:6px;background:#fff3cd;border:1px solid #ffc107;border-radius:4px;color:#856404">
          ‚ö†Ô∏è Large batch detected. Processing may take several minutes depending on file size and resolution.
        </div>
      </div>

      <div id="imageNav" style="display:none;margin-bottom:12px;padding:8px;background:#f0f0f0;border-radius:6px;text-align:center">
        <div style="font-size:12px;color:#666;margin-bottom:6px">
          <span id="currentImageInfo"></span>
        </div>
        <div style="display:flex;gap:4px">
          <button id="prevImage" type="button" style="flex:1">‚Üê Prev</button>
          <button id="nextImage" type="button" style="flex:1">Next ‚Üí</button>
        </div>
      </div>

      <label>Medium
        <select id="artStyle">
          <option value="pencil">Pencil</option>
          <option value="ink">Ink</option>
          <option value="marker">Marker</option>
          <option value="pen">Pen</option>
        </select>
      </label>

      <label>Style
        <select id="style">
          <optgroup label="Clean line styles">
            <option value="contour">Contour drawing</option>
            <option value="gesture">Gesture sketching</option>
            <option value="lineart">Line art / ink outline</option>
            <option value="crosscontour">Cross-contour</option>
          </optgroup>
          <optgroup label="Shading-driven sketch styles">
            <option value="hatching">Hatching</option>
            <option value="crosshatching">Cross-hatching</option>
            <option value="scribble">Scribble shading</option>
            <option value="stippling">Stippling</option>
            <option value="tonalpencil">Tonal pencil rendering</option>
          </optgroup>
          <optgroup label="Expressive / painterly sketch looks">
            <option value="charcoal">Charcoal sketch</option>
            <option value="drybrush">Dry brush / brush pen sketch</option>
            <option value="inkwash">Ink wash sketch</option>
          </optgroup>
          <optgroup label="Stylized / design-heavy sketch styles">
            <option value="comic">Comic / manga inking</option>
            <option value="fashion">Fashion sketch</option>
            <option value="urban">Urban sketching</option>
            <option value="architectural">Architectural sketch</option>
          </optgroup>
          <optgroup label="Classic fine-art ‚Äúold master‚Äù vibes">
            <option value="academic">Academic figure sketch</option>
            <option value="etching">Etching / engraving style</option>
          </optgroup>
          <optgroup label="Modern / experimental sketch styles">
            <option value="minimalist">Minimalist one-line</option>
            <option value="glitch">Glitch / distorted linework</option>
            <option value="mixedmedia">Mixed-media sketch</option>
          </optgroup>
          <optgroup label="Retro / Vintage">
            <option value="photorealism">Retro pen & ink</option>
            <option value="graphiteportrait">Graphite portrait</option>
            <option value="oilpainting">Oil painting study</option>
            <option value="watercolor">Watercolor study</option>
          </optgroup>
        </select>
      </label>

      <label>Brush
        <select id="brush">
          <option value="line">Line</option>
          <option value="hatch">Hatch</option>
          <option value="crosshatch">Cross-hatch</option>
          <option value="charcoal">Charcoal</option>
          <option value="inkWash">Ink Wash</option>
        </select>
      </label>

      <label>Intensity <input id="intensity" type="range" min="1" max="10" value="6"></label>
      <label>Stroke <input id="stroke" type="range" min="1" max="10" value="3"></label>

      <label><input id="skipHatching" type="checkbox" checked> Skip hatching (clean edges only) <button type="button" class="info-btn" data-modal="modal-skiphatching">?</button></label>

      <label><input id="colorize" type="checkbox"> Colorize (add color to sketch) <button type="button" class="info-btn" data-modal="modal-colorize">?</button></label>

      <label>Contrast <input id="contrast" type="range" min="0" max="2" step="0.1" value="1"></label>
      <label>Saturation <input id="saturation" type="range" min="0" max="2" step="0.1" value="1"></label>
      <label>Hue Shift <input id="hueShift" type="range" min="0" max="360" step="5" value="0">¬∞</label>

      <label>Prompt (optional) <button type="button" class="info-btn" data-modal="modal-prompt">?</button>
        <input id="prompt" type="text" placeholder="e.g. dramatic cross-hatching">
      </label>

      <label>Seed <button type="button" class="info-btn" data-modal="modal-seed">?</button>
        <input id="seed" type="number" placeholder="0.." />
      </label>

      <label>Resolution
        <select id="resolution">
          <option value="512">512 px</option>
          <option value="1024" selected>1024 px</option>
          <option value="2048">2048 px</option>
        </select>
      </label>

      <label>Aspect Ratio
        <select id="aspect">
          <option value="1:1">1:1</option>
          <option value="3:4">3:4</option>
          <option value="4:3">4:3</option>
          <option value="16:9">16:9</option>
          <option value="9:16">9:16</option>
        </select>
      </label>

      <label>Output filename <button type="button" class="info-btn" data-modal="modal-outputfilename">?</button>
        <input id="outputName" type="text" placeholder="sketchify_20260220_143045">
      </label>

      <fieldset style="border:1px solid var(--border);border-radius:4px;padding:8px;margin:8px 0">
        <legend style="padding:0 4px;font-size:0.9em;font-weight:600">Presets <button type="button" class="info-btn" data-modal="modal-presets">?</button></legend>
        <label>Preset name
          <input id="presetName" type="text" placeholder="e.g. my-charcoal-style">
        </label>
        <div style="display:flex;gap:4px;margin-bottom:8px">
          <button id="savePreset" type="button" style="flex:1">Save Preset</button>
          <button id="deletePreset" type="button" style="flex:1">Delete</button>
        </div>
        <label>Load preset
          <select id="presetSelect">
            <option value="">-- No presets --</option>
          </select>
        </label>
        <button id="loadPreset" type="button" style="width:100%;margin-top:4px">Load Preset</button>
      </fieldset>

      <label><input id="useWebGL" type="checkbox"> Use GPU (WebGL experimental) <button type="button" class="info-btn" data-modal="modal-gpu">?</button></label>
      <small id="webglStatus" style="display:none;color:green">‚úì GPU accelerated</small>
      <label><input id="useML" type="checkbox"> Use external ML service (default) <button type="button" class="info-btn" data-modal="modal-mlservice">?</button></label>
      <label>ML Service URL <input id="mlUrl" type="text" value="https://api.example.com/ml-sketch" placeholder="https://your-custom-ml-service.com/api"></label>
      <label><input id="useServer" type="checkbox"> Use server style-transfer (requires running server) <button type="button" class="info-btn" data-modal="modal-server">?</button></label>
      <label>Server API URL <input id="serverUrl" type="text" value="http://localhost:5001/api/style-transfer-advanced" placeholder="https://example.com/api/style-transfer"></label>

      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="testServer" type="button">Test Server (demo)</button>
        <small style="align-self:center;color:var(--muted)">Posts demo `test_image.png` to server</small>
      </div>

      <label>Generate <button type="button" class="info-btn" data-modal="modal-generate">?</button></label>

      <div class="buttons" style="margin-bottom:8px">
        <button id="generate" style="width:100%;flex:1">Generate</button>
      </div>

      <div class="buttons">
        <button id="undo" title="Undo (Ctrl+Z)">‚Ü∂ Undo</button>
        <button id="redo" title="Redo (Ctrl+Y)">‚Ü∑ Redo</button>
      </div>

      <div class="buttons">
        <button id="downloadPng">Download PNG</button>
        <button id="downloadJpg">Download JPG</button>
        <button id="downloadZip">Download ZIP</button>
      </div>

      <div class="progress-wrap" hidden>
        <div class="progress-bar" id="progressBar"><div id="progressFill"></div></div>
        <div id="progressText" class="note">Idle</div>
      </div>

      <div id="notification" style="display:none;position:fixed;top:24px;right:24px;background:linear-gradient(135deg, #10b981 0%, #059669 100%);color:#fff;padding:16px 24px;border-radius:10px;box-shadow:0 8px 24px rgba(16, 185, 129, 0.3);z-index:9999;font-size:14px;max-width:400px;animation:slideIn 0.3s ease;border-left:4px solid #6ee7b7">
        <div style="display:flex;align-items:center;gap:12px">
          <span style="font-size:22px">‚úì</span>
          <div>
            <strong>Batch processing complete!</strong>
            <div style="font-size:12px;margin-top:4px;opacity:0.95">Ready to download ZIP or individual images.</div>
          </div>
        </div>
      </div>

      <style>
        @keyframes slideIn {
          from { transform: translateX(450px); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      </style>

    </section>

    <section class="preview" style="display:flex; flex-direction:row; gap:16px; align-items:flex-start;">
      <div style="flex:1; text-align:center;">
        <div style="font-size:13px; color:#888; margin-bottom:4px;">Original</div>
        <canvas id="original" width="512" height="512" style="background:#fff;border:1px solid #ccc;max-width:100%;height:auto;display:block;margin:auto"></canvas>
      </div>
      <div style="flex:1; text-align:center;">
        <div style="font-size:13px; color:#888; margin-bottom:4px;">Rendered</div>
        <canvas id="preview" width="512" height="512" style="background:#fff;border:1px solid #ccc;max-width:100%;height:auto;display:block;margin:auto"></canvas>
        <p class="note">Tip: use larger resolutions for better results. Seed makes effects repeatable.</p>
      </div>
    </section>
  </main>

  <footer>
    <small>&copy; 2026 ArtMondo. All rights reserved. Sketchify is an open-source project licensed under MIT.</small>
  </footer>

  <div id="modal-load" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Load Image/s</h3>
      <p>Select one or more image files (JPG, PNG, etc.) to process. You can upload multiple images and use the Prev/Next buttons to browse through them individually before batch processing.</p>
      <p><strong>Tip:</strong> Use high-quality source images for best results. Larger images may take longer to process.</p>
    </div>
  </div>

  <div id="modal-skiphatching" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Skip Hatching</h3>
      <p>When checked, removes decorative hatching and pattern effects, giving you clean line-based sketches with crisp edges only.</p>
      <p><strong>Best for:</strong> Simple outlines, contour drawings, and minimalist styles.</p>
      <p>When unchecked, hatching and brush textures are applied based on your chosen brush type.</p>
    </div>
  </div>

  <div id="modal-colorize" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Colorize</h3>
      <p>When checked, adds color to your sketch based on the original image, creating a colored sketch effect.</p>
      <p>Combine with Saturation and Hue Shift sliders to fine-tune the color intensity and tone.</p>
      <p><strong>Tip:</strong> Works best with styles like Comic/Manga, Fashion Sketch, or Watercolor to create stylized colored artwork.</p>
    </div>
  </div>

  <div id="modal-prompt" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Prompt</h3>
      <p>An optional text description sent to external ML services or custom servers to guide image processing.</p>
      <p><strong>When it works:</strong> Only used if "Use external ML service" or "Use server style-transfer" is enabled.</p>
      <p><strong>Example prompts:</strong></p>
      <ul>
        <li>"dramatic cross-hatching with bold lines"</li>
        <li>"soft watercolor wash effect"</li>
        <li>"detailed pen stippling"</li>
      </ul>
      <p><strong>Note:</strong> Has no effect during default client-side processing.</p>
    </div>
  </div>

  <div id="modal-seed" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Seed</h3>
      <p>A number that makes random effects (like scribbling or stippling) reproducible. Use the same seed to generate identical sketches from the same image.</p>
      <p><strong>Example:</strong> If Seed = 42 creates a style you like, you can reuse Seed 42 with other images for consistent results.</p>
      <p>Leave blank or 0 for random variation each time.</p>
    </div>
  </div>

  <div id="modal-outputfilename" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Output Filename</h3>
      <p>Specify a custom prefix for downloaded sketch files. When batch processing, this prefix is applied to all generated files.</p>
      <p><strong>Default format:</strong> If left blank, files are named <code>sketchify_YYYYMMdd_HHmmss.png</code> (e.g., <code>sketchify_20260220_143045.png</code>)</p>
      <p><strong>Custom example:</strong> If you enter "my_artwork", files will be named <code>my_artwork_1.png</code>, <code>my_artwork_2.png</code>, etc.</p>
    </div>
  </div>

  <div id="modal-presets" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Presets</h3>
      <p>Save and load your favorite configuration combinations (style, brush, intensity, saturation, etc.) for quick reuse.</p>
      <p><strong>How to save:</strong></p>
      <ol>
        <li>Adjust all settings to your liking</li>
        <li>Enter a preset name (e.g., "dramatic-charcoal")</li>
        <li>Click "Save Preset"</li>
      </ol>
      <p><strong>How to load:</strong></p>
      <ol>
        <li>Select a preset from the dropdown</li>
        <li>Click "Load Preset"</li>
      </ol>
      <p>Presets are stored in your browser and persist across sessions.</p>
    </div>
  </div>

  <div id="modal-gpu" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Use GPU (WebGL)</h3>
      <p>Enables GPU-accelerated edge detection using WebGL for faster real-time previews on large images.</p>
      <p><strong>Benefits:</strong> Significantly faster processing on devices with modern GPUs.</p>
      <p><strong>Fallback:</strong> If GPU is unavailable or unsupported, processing automatically falls back to CPU.</p>
      <p><strong>Note:</strong> This is experimental and may have different results on some browsers.</p>
    </div>
  </div>

  <div id="modal-mlservice" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Use External ML Service</h3>
      <p>Sends images to a custom ML endpoint (e.g., style transfer API) instead of using built-in sketch styles.</p>
      <p><strong>When to use:</strong> You have a custom ML model or proprietary style transfer service.</p>
      <p><strong>Privacy note:</strong> Images will be uploaded to your specified ML service ‚Äî use only with trusted endpoints.</p>
      <p><strong>Configuration:</strong></p>
      <ol>
        <li>Enable this checkbox</li>
        <li>Enter your ML Service URL</li>
        <li>Upload images and click Generate</li>
      </ol>
      <p>The Prompt field will be sent to your ML service if configured to use it.</p>
    </div>
  </div>

  <div id="modal-server" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Use Server Style-Transfer</h3>
      <p>Sends images to your own custom Flask/Python server for processing instead of using built-in sketch styles.</p>
      <p><strong>When to use:</strong> You have a local or remote server running (e.g., with OpenCV, advanced algorithms).</p>
      <p><strong>Setup:</strong></p>
      <ol>
        <li>Run <code>python server.py</code> or <code>python server_advanced.py</code></li>
        <li>Note the server URL (default: <code>http://localhost:5000/api/style-transfer</code>)</li>
        <li>Enable this checkbox and enter your Server API URL</li>
        <li>Upload images and click Generate</li>
      </ol>
      <p><strong>Note:</strong> Server must be running for this to work. Images stay on your server unless you configure otherwise.</p>
    </div>
  </div>

  <div id="modal-generate" class="modal" style="display:none">
    <div class="modal-content">
      <button class="modal-close" type="button">&times;</button>
      <h3>Generate</h3>
      <p>Processes all uploaded images with your current settings (style, brush, intensity, etc.).</p>
      <p><strong>Processing:</strong></p>
      <ul>
        <li>Single image: Processes instantly in your browser</li>
        <li>Multiple images: Processed sequentially to save memory</li>
        <li>Progress bar shows real-time status</li>
      </ul>
      <p><strong>After generation:</strong> Download individual images as PNG/JPG or bundle all into a ZIP file.</p>
      <p><strong>Tip:</strong> For faster processing, reduce resolution or enable GPU acceleration.</p>
      <p>Images are downloaded to your device ‚Äî nothing is stored on servers by default.</p>
    </div>
  </div>

  <style>
    .info-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      padding: 0;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 4px;
      transition: all 0.2s ease;
    }
    .info-btn:hover {
      background: var(--secondary);
      transform: scale(1.1);
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.2s ease;
    }

    .modal.hidden {
      display: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .modal-content h3 {
      margin-top: 0;
      color: var(--primary);
      font-size: 20px;
      margin-bottom: 12px;
    }

    .modal-content p {
      margin: 8px 0;
      line-height: 1.5;
      color: var(--text);
    }

    .modal-content ol,
    .modal-content ul {
      margin: 8px 0 8px 20px;
      padding: 0;
    }

    .modal-content li {
      margin: 4px 0;
    }

    .modal-content code {
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 12px;
    }

    .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: var(--muted);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: var(--text);
    }

    body.dark-mode .modal-content {
      background: var(--card);
      color: var(--text);
    }

    body.dark-mode .modal-content code {
      background: rgba(148, 163, 184, 0.1);
      color: #94a3b8;
    }
  </style>

  <script src="jszip.min.js"></script>
  <script src="script.js"></script>
  <script>
    // Dark mode toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    const htmlElement = document.documentElement;
    
    // Check localStorage for dark mode preference
    const isDarkMode = localStorage.getItem('darkMode') === 'true';
    if (isDarkMode) {
      document.body.classList.add('dark-mode');
      darkModeToggle.textContent = '‚òÄÔ∏è';
    }
    
    // Toggle dark mode
    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const isNowDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isNowDark);
      darkModeToggle.textContent = isNowDark ? '‚òÄÔ∏è' : 'üåô';
    });

    // Modal functionality
    document.querySelectorAll('.info-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const modalId = btn.getAttribute('data-modal');
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.style.display = 'flex';
        }
      });
    });

    // Close modals
    document.querySelectorAll('.modal-close').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.target.closest('.modal').style.display = 'none';
      });
    });

    // Close modal when clicking outside
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.style.display = 'none';
        }
      });
    });

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal').forEach(m => {
          m.style.display = 'none';
        });
      }
    });
  </script>

